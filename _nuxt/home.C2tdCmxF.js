import{u as A,a as T,_ as X}from"./useAuth.TQvSoEEw.js";import{u as ce,t as le,o as de,_ as _e,s as $,m as U,a as P}from"./vee-validate-valibot.esm.CPzRYaW_.js";import{r as L,L as Y,_ as w,t as o,v as a,x as s,M as ue,N as me,y as l,z as m,O as q,P as c,Q as S,R as I,B as O,A as G,S as he,T as pe,U as Ce,V as ve,c as b,W as V,X as H,Y as ye,Z as K}from"./entry.DJLNJNwO.js";import"./cookie.CgwEJbi6.js";const fe=e=>{const t=e.a[e.key].toUpperCase(),n=e.b[e.key].toUpperCase();return t<n?-1:t>n?1:0},B=L(""),F=L(""),D=e=>{B.value=e},R=e=>{F.value=e},x=()=>{B.value="",F.value=""},z=e=>({f:e.surname,i:e.name,o:e.middleName,phone:e.phone,city:e.city,address:e.address,birthday:e.birthday}),ge=e=>e.map(t=>({id:t.id,name:t.i,surname:t.f,middlename:t.o,phone:t.phone,city:t.city,address:t.address,birthday:t.birthday})),$e=e=>({id:e.id,name:e.i,surname:e.f,middlename:e.o,phone:e.phone,city:e.city,address:e.address,birthday:e.birthday}),Q=e=>{const t={};for(const n of Object.values(e))t[n.name]=n.value;return t},Z=e=>{for(const t in e)if(t)return!1;return!0},M=e=>e??"",j=Y("usersStore",{state:()=>({users:[],user:{},pagination:{}}),getters:{sortByKey:e=>t=>t?e.users.sort((n,i)=>fe({a:n,b:i,key:t})):e.users},actions:{deleteUserByIndex(e){this.users.splice(e,1)},addUsers(e){this.users.push(e)},async getUsers(e=1){x();try{data!=null&&data.items&&(this.users=ge(data.items),this.pagination=data._meta)}catch(t){console.log(t)}},async getUser(e){x();try{await A().refreshToken();const t=await T(`/records/${e}`);this.user=t?$e(t):null}catch(t){console.log(t)}},async deleteUser(e){try{await A().refreshToken(),await T(`/records/${e.id}`,{method:"DELETE"})&&(this.deleteUserByIndex(e.index),D("Пользователь удален"))}catch(t){console.log(t)}},async addUser(e){x();try{await A().refreshToken();const t=Q(e.data);if(Z(e.errors)&&!Z(t)){const n=z(t),i=await T("/records",{method:"POST",body:{...n}});i&&(D("Пользователь успешно добавлен"),this.users.length<10&&this.addUsers(i))}else R("Ошибка, поля некорректные")}catch(t){console.log(t)}},async editUser(e){x();try{await A().refreshToken();const t=e.userId,n=Q(e.data);if(Z(e.errors)&&!Z(n)){const i=z(n);await T(`/records/${t}`,{method:"PUT",body:{...i}})&&D("Пользователь сохранен")}}catch{R("Ошибка, поля некорректные")}}}}),Ue={},Me={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},we=s("path",{d:"M0.857178 0.857147L15.1429 15.1429M15.1429 0.857147L0.857178 15.1429",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),ke=[we];function Le(e,t){return o(),a("svg",Me,ke)}const be=w(Ue,[["render",Le]]),xe={class:"modal"},Ve={class:"modal__container"},Se={class:"modal__container-title"},Ie={class:"modal__container-form"},Be={key:0},Ee={key:1},Ae=s("span",null,"*",-1),Te={class:"success-status"},Pe={class:"error-status"},Ze={__name:"Modal",props:{title:String,buttonTitle:String,userId:Number|null},emits:["close-modal","user-action"],async setup(e){let t,n;const i=e,r=j();i.userId&&([t,n]=ue(()=>r.getUser(i.userId)),t=await t,n());const{errors:h}=ce({validationSchema:le(de({surname:$([U(2,"Фамилия слишком короткая"),P(20,"Слишком длинная фамилия")]),name:$([U(2,"Имя слишком короткое"),P(15,"Слишком длинное имя")]),middleName:$([U(5,"Отчество слишком короткое")]),phone:$([U(12,"Некорректный номер телефона"),P(13,"Слишком длинный номер")]),city:$([U(2,"Название города слишком короткое"),P(20,"Слишком длинное название города")]),address:$([U(5,"Некорректный адрес")]),birthday:$([U(9,"Дата некорректная")])}))}),g=me([{title:"Фамилия",name:"surname",value:M(r.user.surname)},{title:"Имя",name:"name",value:M(r.user.name)},{title:"Отчество",name:"middleName",value:M(r.user.middlename)},{title:"Город",name:"city",value:M(r.user.city)},{title:"Адрес",name:"address",value:M(r.user.address)},{title:"Дата рождения",name:"birthday",type:"Date",value:M(r.user.birthday)},{title:"Номер телефона",name:"phone",value:M(r.user.phone)}]);return(u,p)=>{const k=_e,f=X;return o(),a("div",xe,[s("div",Ve,[s("div",Se,[s("div",null,l(e.title),1),s("button",{onClick:p[0]||(p[0]=_=>u.$emit("close-modal"))},[m(be)])]),s("form",{onSubmit:p[1]||(p[1]=q(_=>u.$emit("user-action",{data:c(g),errors:c(h),userId:e.userId}),["prevent"]))},[s("div",Ie,[(o(!0),a(S,null,I(c(g),(_,d)=>(o(),a("label",{key:d,class:"modal__container-row"},[_.title==="Отчество"?(o(),a("div",Be,l(_.title),1)):(o(),a("div",Ee,[Ae,O(l(_.title),1)])),m(k,{name:_.name,type:_.type,modelValue:_.value,"onUpdate:modelValue":C=>_.value=C},null,8,["name","type","modelValue","onUpdate:modelValue"])]))),128))]),m(f,{type:"submit",color:"green",class:"modal__container-button"},{default:G(()=>[O(l(e.buttonTitle),1)]),_:1}),s("div",Te,l("successMessage"in u?u.successMessage:c(B)),1),s("div",Pe,l("errorMessage"in u?u.errorMessage:c(F)),1)],32)])])}}},He=Ze,De=["type"],Oe={__name:"Input",props:he({type:{type:String,default:"text"}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const t=pe(e,"value");return(n,i)=>Ce((o(),a("input",{class:"input",type:e.type,"onUpdate:modelValue":i[0]||(i[0]=r=>t.value=r)},null,8,De)),[[ve,t.value]])}},Fe=Oe,J=Y("usersFiltering",{state:()=>({filter:[{title:"Фамилия",value:"",type:"text",key:"surname"},{title:"Имя",value:"",type:"text",key:"name"},{title:"Отчество",value:"",type:"text",key:"middlename"},{title:"Город",value:"",type:"text",key:"city"},{title:"Адрес",value:"",type:"text",key:"address"},{title:"Дата рождения",value:"",type:"date",key:"birthday"},{title:"Номер телефона",value:"",type:"text",key:"phone"}]}),actions:{searchUser(e){return e.filter(t=>this.filter.every(n=>{const i=t[n.key].toString().toLowerCase(),r=n.value.toString().toLowerCase();return i.includes(r)}))}}}),je={},Ne={width:"15",height:"12",viewBox:"0 0 15 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ke=s("path",{d:"M3.62395 0.862005C3.74897 0.737025 3.91851 0.666814 4.09528 0.666814C4.27206 0.666814 4.4416 0.737025 4.56662 0.862005L7.23328 3.52867C7.35472 3.65441 7.42192 3.82281 7.4204 3.99761C7.41888 4.1724 7.34877 4.33961 7.22516 4.46322C7.10156 4.58682 6.93435 4.65694 6.75955 4.65845C6.58475 4.65997 6.41635 4.59278 6.29062 4.47134L4.76195 2.94267V10.6667C4.76195 10.8435 4.69171 11.0131 4.56669 11.1381C4.44166 11.2631 4.27209 11.3333 4.09528 11.3333C3.91847 11.3333 3.7489 11.2631 3.62388 11.1381C3.49885 11.0131 3.42862 10.8435 3.42862 10.6667V2.94267L1.89995 4.47134C1.77421 4.59278 1.60581 4.65997 1.43102 4.65845C1.25622 4.65694 1.08901 4.58682 0.965404 4.46322C0.841798 4.33961 0.771686 4.1724 0.770167 3.99761C0.768648 3.82281 0.835844 3.65441 0.957283 3.52867L3.62395 0.862005ZM10.0953 9.05734V1.33334C10.0953 1.15653 10.1655 0.986958 10.2905 0.861934C10.4156 0.73691 10.5851 0.666672 10.7619 0.666672C10.9388 0.666672 11.1083 0.73691 11.2334 0.861934C11.3584 0.986958 11.4286 1.15653 11.4286 1.33334V9.05734L12.9573 7.52867C13.083 7.40723 13.2514 7.34004 13.4262 7.34156C13.601 7.34308 13.7682 7.41319 13.8918 7.53679C14.0154 7.6604 14.0855 7.82761 14.0871 8.0024C14.0886 8.1772 14.0214 8.3456 13.8999 8.47134L11.2333 11.138C11.1083 11.263 10.9387 11.3332 10.7619 11.3332C10.5852 11.3332 10.4156 11.263 10.2906 11.138L7.62395 8.47134C7.50251 8.3456 7.43531 8.1772 7.43683 8.0024C7.43835 7.82761 7.50846 7.6604 7.63207 7.53679C7.75568 7.41319 7.92288 7.34308 8.09768 7.34156C8.27248 7.34004 8.44088 7.40723 8.56662 7.52867L10.0953 9.05734Z",fill:"#2C2E35","fill-opacity":"0.15"},null,-1),Re=[Ke];function ze(e,t){return o(),a("svg",Ne,Re)}const Qe=w(je,[["render",ze]]),We={class:"main__form"},Xe={class:"main__form-filter"},Ye=["onClick"],qe={__name:"UserFilters",emits:["select-key"],setup(e){const t=J();return(n,i)=>{const r=Fe;return o(),a("form",We,[(o(!0),a(S,null,I(c(t).filter,(h,g)=>(o(),a("label",{key:g},[s("div",Xe,[s("strong",null,l(h.title),1),s("button",{onClick:q(u=>n.$emit("select-key",h.key),["prevent"])},[m(Qe)],8,Ye)]),m(r,{type:h.type,value:h.value,"onUpdate:value":u=>h.value=u},null,8,["type","value","onUpdate:value"])]))),128))])}}},Ge=qe,Je={},et={class:"custom-loader"};function tt(e,t){return o(),a("div",et)}const st=w(Je,[["render",tt]]),nt={},ot={width:"11",height:"10",viewBox:"0 0 11 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},at=s("path",{d:"M6.52699 9.5L5.76136 8.74432L8.91335 5.59233H0.75V4.49858H8.91335L5.76136 1.35653L6.52699 0.590909L10.9815 5.04545L6.52699 9.5Z",fill:"#2C2E35"},null,-1),it=[at];function rt(e,t){return o(),a("svg",ot,it)}const ct=w(nt,[["render",rt]]),lt={},dt={width:"11",height:"10",viewBox:"0 0 11 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_t=s("path",{d:"M4.83665 9.5L0.382102 5.04545L4.83665 0.590909L5.60227 1.34659L2.45028 4.49858H10.6136V5.59233H2.45028L5.60227 8.73438L4.83665 9.5Z",fill:"#2C2E35"},null,-1),ut=[_t];function mt(e,t){return o(),a("svg",dt,ut)}const ht=w(lt,[["render",mt]]),pt={class:"pagination"},Ct={class:"pagination__list"},vt={key:0,class:"pagination__items"},yt=["disabled"],ft=["onClick","disabled"],gt=["disabled"],$t={key:1,class:"pagination__items"},Ut=["onClick"],Mt={key:0,class:"pagination__note"},wt={__name:"Pagination",setup(e){const t=L(1),n=j(),i=b(()=>n.pagination.totalCount),r=b(()=>n.pagination.pageCount),h=b(()=>`Показаны записи 1-${n.users.length} из ${i.value}`),g=b(()=>{const f=Math.max(1,t.value-2),_=Math.min(r.value,f+4),d=[];for(let C=_-4;C<=_;C++)C>0&&d.push(C);return d}),u=()=>{t.value>0&&(t.value--,n.getUsers(t))},p=()=>{t.value<r.value&&(t.value++,n.getUsers(t.value))},k=f=>{t.value=f,n.getUsers(t.value)};return(f,_)=>(o(),a("div",pt,[s("div",Ct,[r.value>5?(o(),a("div",vt,[s("button",{onClick:u,class:"pagination__navigate",disabled:t.value===1},[m(ht)],8,yt),(o(!0),a(S,null,I(g.value,d=>(o(),a("ul",{key:d},[s("button",{onClick:C=>k(d),class:V(["pagination__button",{active:t.value===d}]),disabled:t.value===d},l(d),11,ft)]))),128)),s("button",{onClick:p,class:"pagination__navigate",disabled:t.value===r.value},[m(ct)],8,gt)])):(o(),a("div",$t,[(o(!0),a(S,null,I(r.value,d=>(o(),a("ul",{key:d},[s("button",{onClick:C=>k(d),class:V(["pagination__button",{active:t.value===d}])},l(d),11,Ut)]))),128))]))]),i.value?(o(),a("div",Mt,l(h.value),1)):H("",!0)]))}},kt=wt,W=()=>{const e=L(!1);return{isOpenModal:e,openModal:()=>{e.value=!0,x()},closeModal:()=>e.value=!1}},Lt={},bt={width:"14",height:"15",viewBox:"0 0 14 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},xt=s("path",{d:"M13.2824 1.217C13.0554 0.989939 12.7859 0.809821 12.4893 0.686933C12.1927 0.564045 11.8748 0.500795 11.5537 0.500795C11.2326 0.500795 10.9147 0.564045 10.6181 0.686933C10.3215 0.809821 10.0519 0.989939 9.82495 1.217L1.17845 9.865C0.926295 10.117 0.752319 10.4365 0.677446 10.785L0.0109461 13.895C-0.00663054 13.9767 -0.00346029 14.0615 0.0201672 14.1416C0.0437946 14.2217 0.087126 14.2947 0.146202 14.3537C0.205279 14.4128 0.278217 14.4562 0.358353 14.4798C0.43849 14.5034 0.523269 14.5066 0.604946 14.489L3.71495 13.8225C4.06348 13.7476 4.38295 13.5736 4.63495 13.3215L13.2824 4.674C13.7407 4.2155 13.9982 3.59377 13.9982 2.9455C13.9982 2.29723 13.7407 1.6755 13.2824 1.217ZM10.5324 1.924C10.8058 1.66545 11.1693 1.52375 11.5456 1.52902C11.9218 1.53429 12.2812 1.68613 12.5472 1.95224C12.8132 2.21834 12.965 2.57773 12.9702 2.95398C12.9754 3.33024 12.8336 3.69367 12.5749 3.967L12.1249 4.417L10.0819 2.3745L10.5324 1.924ZM9.37445 3.0815L11.4174 5.1245L3.92845 12.615C3.81256 12.7308 3.66567 12.8107 3.50545 12.845L1.14995 13.35L1.65495 10.995C1.68924 10.8348 1.76911 10.6879 1.88495 10.572L9.37445 3.0815Z",fill:"#0098DA"},null,-1),Vt=[xt];function St(e,t){return o(),a("svg",bt,Vt)}const It=w(Lt,[["render",St]]),Bt={},Et={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},At=s("path",{d:"M6.66658 3.83333H9.33325C9.33325 3.47971 9.19278 3.14057 8.94273 2.89052C8.69268 2.64048 8.35354 2.5 7.99992 2.5C7.6463 2.5 7.30716 2.64048 7.05711 2.89052C6.80706 3.14057 6.66658 3.47971 6.66658 3.83333ZM5.66658 3.83333C5.66658 3.52692 5.72694 3.2235 5.8442 2.94041C5.96146 2.65731 6.13333 2.40009 6.35 2.18342C6.56667 1.96675 6.8239 1.79488 7.10699 1.67761C7.39008 1.56035 7.6935 1.5 7.99992 1.5C8.30634 1.5 8.60975 1.56035 8.89285 1.67761C9.17594 1.79488 9.43316 1.96675 9.64983 2.18342C9.8665 2.40009 10.0384 2.65731 10.1556 2.94041C10.2729 3.2235 10.3333 3.52692 10.3333 3.83333H14.1666C14.2992 3.83333 14.4264 3.88601 14.5201 3.97978C14.6139 4.07355 14.6666 4.20073 14.6666 4.33333C14.6666 4.46594 14.6139 4.59312 14.5201 4.68689C14.4264 4.78066 14.2992 4.83333 14.1666 4.83333H13.2866L12.5066 12.9073C12.4468 13.526 12.1586 14.1002 11.6984 14.5179C11.2381 14.9356 10.6388 15.1669 10.0173 15.1667H5.98258C5.36116 15.1667 4.76199 14.9354 4.30188 14.5177C3.84178 14.1 3.55374 13.5259 3.49392 12.9073L2.71325 4.83333H1.83325C1.70064 4.83333 1.57347 4.78066 1.4797 4.68689C1.38593 4.59312 1.33325 4.46594 1.33325 4.33333C1.33325 4.20073 1.38593 4.07355 1.4797 3.97978C1.57347 3.88601 1.70064 3.83333 1.83325 3.83333H5.66658ZM6.99992 7C6.99992 6.86739 6.94724 6.74022 6.85347 6.64645C6.7597 6.55268 6.63253 6.5 6.49992 6.5C6.36731 6.5 6.24013 6.55268 6.14637 6.64645C6.0526 6.74022 5.99992 6.86739 5.99992 7V12C5.99992 12.1326 6.0526 12.2598 6.14637 12.3536C6.24013 12.4473 6.36731 12.5 6.49992 12.5C6.63253 12.5 6.7597 12.4473 6.85347 12.3536C6.94724 12.2598 6.99992 12.1326 6.99992 12V7ZM9.49992 6.5C9.63253 6.5 9.7597 6.55268 9.85347 6.64645C9.94724 6.74022 9.99992 6.86739 9.99992 7V12C9.99992 12.1326 9.94724 12.2598 9.85347 12.3536C9.7597 12.4473 9.63253 12.5 9.49992 12.5C9.36731 12.5 9.24013 12.4473 9.14637 12.3536C9.0526 12.2598 8.99992 12.1326 8.99992 12V7C8.99992 6.86739 9.0526 6.74022 9.14637 6.64645C9.24013 6.55268 9.36731 6.5 9.49992 6.5ZM4.48925 12.8113C4.52521 13.1824 4.69808 13.5268 4.97416 13.7774C5.25025 14.028 5.60975 14.1667 5.98258 14.1667H10.0173C10.3901 14.1667 10.7496 14.028 11.0257 13.7774C11.3018 13.5268 11.4746 13.1824 11.5106 12.8113L12.2826 4.83333H3.71725L4.48925 12.8113Z",fill:"#DA0D00"},null,-1),Tt=[At];function Pt(e,t){return o(),a("svg",Et,Tt)}const Zt=w(Bt,[["render",Pt]]),Ht={class:"main"},Dt={class:"main__content"},Ot={key:1},Ft={class:"main__buttons"},jt=["onClick"],Nt=["onClick"],Kt={key:2,class:"main__spinner"},Rt={key:4,class:"success-status"},qt={__name:"home",setup(e){const t=L(null),n=L(0),i=j(),r=J(),{sortByKey:h}=ye(i),g=b(()=>i.users.length);i.getUsers();const u=v=>t.value=v,p=v=>v%2?"bg-silver":"",{isOpenModal:k,openModal:f,closeModal:_}=W(),{isOpenModal:d,openModal:C,closeModal:ee}=W(),te=v=>{n.value=v,C()},se=()=>{i.user={},ee()};return(v,zt)=>{const ne=X,N=He,oe=Ge,ae=st,ie=kt;return o(),a("main",Ht,[s("div",Dt,[m(ne,{onClick:c(f)},{default:G(()=>[O(" ДОБАВИТЬ ЗАПИСЬ ")]),_:1},8,["onClick"]),c(k)?(o(),K(N,{key:0,onUserAction:c(i).addUser,onCloseModal:c(_),"button-title":"ДОБАВИТЬ",title:"Добавить запись"},null,8,["onUserAction","onCloseModal"])):H("",!0),m(oe,{onSelectKey:u}),c(g)?(o(),a("div",Ot,[(o(!0),a(S,null,I(c(r).searchUser(c(h)(c(t))),(y,E)=>(o(),a("ul",{class:"main__list",key:y.id},[s("div",{class:V(["main__item",p(E)])},[s("p",null,l(y.surname),1),s("p",null,l(y.name),1),s("p",null,l(y.middlename),1),s("p",null,l(y.city),1),s("p",null,l(y.address),1),s("p",null,l(y.birthday),1),s("p",null,l(y.phone),1),s("div",Ft,[s("button",{class:V(p(E)),onClick:re=>te(y.id)},[m(It)],10,jt),s("button",{class:V(p(E)),onClick:re=>c(i).deleteUser({id:y.id,index:E})},[m(Zt)],10,Nt)])],2)]))),128))])):(o(),a("div",Kt,[m(ae)])),c(d)?(o(),K(N,{key:3,onCloseModal:se,onUserAction:c(i).editUser,"user-id":c(n),title:"Редактировать пользователя","button-title":"СОХРАНИТЬ"},null,8,["onUserAction","user-id"])):H("",!0),("successMessage"in v?v.successMessage:c(B))==="Пользователь удален"?(o(),a("div",Rt,l("successMessage"in v?v.successMessage:c(B)),1)):H("",!0),m(ie)])])}}};export{qt as default};
